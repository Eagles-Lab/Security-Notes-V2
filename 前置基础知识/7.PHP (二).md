# Day3 前置基础知识-PHP(二)

## 一、PHP 基础概念：Web 开发的 "服务器端脚本语言"

### 1.1 什么是 PHP？

PHP，即 **PHP: Hypertext Preprocessor（PHP：超文本预处理器）**，是一种广泛使用的开源脚本语言，特别适用于 Web 开发并可嵌入到 HTML 中。PHP 运行在服务器端，能够生成动态网页内容、处理表单数据、操作数据库、管理会话等，是构建现代 Web 应用程序的核心技术之一。

在网络安全领域，PHP 应用程序是渗透测试和漏洞分析的重要目标，了解 PHP 语法和特性有助于理解和发现常见的 Web 安全漏洞（如 SQL 注入、代码执行、文件包含等）。

### 1.2 PHP 的核心特性

| 特性             | 说明                                           | 安全注意点                                 |
| ---------------- | ---------------------------------------------- | ------------------------------------------ |
| **服务器端执行** | PHP 代码在服务器上执行，客户端只能看到输出结果 | 源代码相对安全，但配置错误可能导致源码泄露 |
| **动态类型**     | 变量无需声明类型，运行时自动判断               | 可能导致类型混淆漏洞，需要严格的输入验证   |
| **嵌入式**       | 可以直接嵌入到 HTML 中                         | 混合代码可能导致 XSS 漏洞，需要输出过滤    |
| **跨平台**       | 支持多种操作系统和 Web 服务器                  | 不同环境的配置差异可能产生安全风险         |
| **丰富的扩展**   | 大量内置函数和第三方库                         | 过时或不安全的函数可能带来漏洞风险         |

## 二、PHP 基本语法格式

### 2.1 PHP 代码标记

PHP 代码必须包含在特定的标记内，服务器才会将其识别为 PHP 代码并执行。

#### 基本语法格式

```php
<?php
    // PHP 代码写在这里
    echo "Hello, World!";
		//echo 用来“打印文本”。print_r 用来“查看变量结构（尤其是数组/对象）”。
?>
```

#### PHP 标记类型

| 标记类型      | 语法                                    | 说明                          | 安全建议                    |
| ------------- | --------------------------------------- | ----------------------------- | --------------------------- |
| **标准标记**  | `<?php ... ?>`                          | 推荐使用，兼容性最好          | ✅ 生产环境首选              |
| **短标记**    | `<? ... ?>`                             | 需要配置开启 `short_open_tag` | ⚠️ 可能与 XML 冲突，不推荐   |
| **Echo 标记** | `<?= ... ?>`                            | 相当于 `<?php echo ... ?>`    | ✅ 输出时使用，注意 XSS 防护 |
| **脚本标记**  | `<script language="php"> ... </script>` | 已废弃                        | ❌ 不推荐使用                |

### 2.2 变量和数据类型

#### 2.2.1 变量声明与命名

PHP 变量以美元符号 `$` 开头，后跟变量名。变量名区分大小写，必须以字母或下划线开头。

```php
<?php
    // 正确的变量命名
    $username = "admin";
    $user_age = 25;
    $_config = "configuration";
    
    // 错误的变量命名（安全风险示例）
    // $123abc = "invalid";  // 不能以数字开头
    // $user-name = "test";  // 不能包含连字符
?>
```

#### 2.2.2 PHP 数据类型

| 数据类型             | 说明         | 示例                         | 安全注意点                        |
| -------------------- | ------------ | ---------------------------- | --------------------------------- |
| **字符串 (String)**  | 文本数据     | `$name = "John";`            | 需要过滤特殊字符，防止 XSS 和注入 |
| **整数 (Integer)**   | 整型数字     | `$age = 25;`                 | 注意整数溢出和类型转换            |
| **浮点数 (Float)**   | 小数         | `$price = 99.99;`            | 浮点数比较需要特别处理            |
| **布尔值 (Boolean)** | 真/假        | `$isActive = true;`          | 注意弱类型比较的陷阱              |
| **数组 (Array)**     | 多个值的集合 | `$colors = ["red", "blue"];` | 防止数组注入和越界访问            |
| **对象 (Object)**    | 类的实例     | `$user = new User();`        | 防止对象注入和序列化漏洞          |
| **资源 (Resource)**  | 外部资源引用 | 文件句柄、数据库连接         | 及时释放资源，防止资源耗尽        |
| **NULL**             | 空值         | `$empty = null;`             | 注意 NULL 值的处理逻辑            |

### 2.3 运算符

#### 2.3.1 算术运算符

```php
<?php
    $a = 10;
    $b = 3;
    
    echo $a + $b;   // 加法：13
    echo $a - $b;   // 减法：7
    echo $a * $b;   // 乘法：30
    echo $a / $b;   // 除法：3.3333...
    echo $a % $b;   // 取余：1
    echo $a ** $b;  // 幂运算：1000 (PHP 5.6+)
?>
```

#### 2.3.2 比较运算符（重要安全概念）

PHP 的比较运算符是许多安全漏洞的源头，特别是弱类型比较：

```php
<?php
    // 弱类型比较（==）- 安全风险！
    var_dump("123" == 123);     // true - 字符串自动转换为数字
    var_dump("0e123" == "0e456"); // true - 科学计数法漏洞
    var_dump(null == false);    // true - 类型转换陷阱
    
    // 强类型比较（===）- 推荐！
    var_dump("123" === 123);    // false - 类型和值都要相同
    var_dump(null === false);   // false - 类型不同
?>
```

**安全建议**：始终使用强类型比较 (`===` 和 `!==`) 来避免类型混淆漏洞。

在 PHP 中，`var_dump()` 是一个**调试函数**，用于输出变量的**详细信息**，包括**类型**和**值**。它是学习 PHP 和排查代码问题时最常用的工具之一。

```php
var_dump($变量);
```

- **显示变量的值**
- **显示变量的数据类型**（如 string、int、bool、array 等）
- **显示变量的长度**（如字符串长度、数组元素个数）
- **对复杂类型（数组、对象）会递归展开显示结构和内容**

#### 2.3.3 逻辑运算符

```php
<?php
    $isLoggedIn = true;
    $isAdmin = false;
    
    // 逻辑与
    if ($isLoggedIn && $isAdmin) {
        echo "管理员权限";
    }
    
    // 逻辑或
    if ($isLoggedIn || $isAdmin) {
        echo "有权限访问";
    }
    
    // 逻辑非
    if (!$isAdmin) {
        echo "非管理员用户";
    }
?>
```

### 2.4 控制语句

#### 2.4.1 条件语句

```php
<?php
    $userRole = $_POST['role'] ?? 'guest';//如果 $_POST['role'] 存在且不为 null，就取它的值；否则默认设为 'guest'。也就是当表单没提交或没传 role 时，$userRole = 'guest'。
    
    // if-elseif-else 语句
    if ($userRole === 'admin') {
        echo "管理员界面";
    } elseif ($userRole === 'user') {
        echo "用户界面";
    } else {
        echo "访客界面";
    }
    
    // switch 语句
    switch ($userRole) {
        case 'admin':
            echo "管理员权限";
            break;
        case 'user':
            echo "普通用户权限";
            break;
        default:
            echo "访客权限";
            break;
    }
?>
```

**安全注意**：使用 `$_POST['role'] ?? 'guest'` 这种方式可以防止未定义变量错误，同时提供默认值。

#### 2.4.2 循环语句

```php
<?php
    $users = ['alice', 'bob', 'charlie'];
    
    // for 循环
    for ($i = 0; $i < count($users); $i++) {
        echo "用户 " . ($i + 1) . ": " . $users[$i] . "<br>";
    }
    
    // foreach 循环（推荐用于数组），=> 在 PHP 中是「键值映射符」（key-value operator）意思就是：“左边是键，右边是值”。
    foreach ($users as $index => $username) {
        echo "索引 $index: $username<br>";
    }
    
    // while 循环
    $counter = 0;
    while ($counter < 3) {
        echo "计数: $counter<br>";
        $counter++;
    }
    
    // do-while 循环
    do {
        echo "至少执行一次<br>";
        $counter--;
    } while ($counter > 0);
?>
```

**🚫 错误示例总结**

| 写法                    | 结果                | 是否正确 |
| ----------------------- | ------------------- | -------- |
| `"你好.$name.!"`        | 输出 `你好.$name.!` | ❌ 错误   |
| `"你好 $name!"`         | 输出 `你好 小明!`   | ✅ 正确   |
| `"你好 " . $name . "!"` | 输出 `你好 小明!`   | ✅ 正确   |

> 注意：变量直接写在双引号里即可，不用加点号。
>  如果变量名后面紧跟文字，可能要加花括号区分：
>
> ```php
> echo "你好 {$name}同学！";
> ```

### 2.5 PHP数组：数据存储的核心

PHP数组是网络安全学习中的重要概念，许多漏洞（如数组注入、反序列化漏洞）都与数组操作相关。

#### 2.5.1 数组的创建与类型

array.php

```php
<?php
    // 索引数组（数字索引）
    $fruits = array("苹果", "香蕉", "橙子");
    $colors = ["红色", "绿色", "蓝色"];  // PHP 5.4+ 简写语法
    
    // 关联数组（字符串索引）
    $user = array(
        "name" => "张三",
        "age" => 25,
        "role" => "admin"
    );
    
    // 简写语法
    $config = [
        "host" => "localhost",
        "port" => 3306,
        "database" => "security_test"
    ];
    
    // 多维数组
    $users = [
        ["name" => "Alice", "age" => 25, "permissions" => ["read", "write"]],
        ["name" => "Bob", "age" => 30, "permissions" => ["read"]],
        ["name" => "Charlie", "age" => 35, "permissions" => ["read", "write", "admin"]]
    ];
?>
```

#### 2.5.2 数组操作函数

| 函数名           | 功能                       | 语法示例                         | 安全注意点                           |
| ---------------- | -------------------------- | -------------------------------- | ------------------------------------ |
| `count()`        | 获取数组元素个数           | `count($array)`                  | 用于输入验证，防止空数组攻击         |
| `array_push()`   | 向数组末尾添加元素         | `array_push($array, $value)`     | 验证添加的数据类型和内容             |
| `array_pop()`    | 删除并返回数组最后一个元素 | `array_pop($array)`              | 检查数组是否为空                     |
| `in_array()`     | 检查值是否存在于数组中     | `in_array($value, $array, true)` | ⚠️ 第三个参数必须为true，使用严格比较 |
| `array_keys()`   | 返回数组的所有键           | `array_keys($array)`             | 防止键名泄露敏感信息                 |
| `array_values()` | 返回数组的所有值           | `array_values($array)`           | 重新索引数组，防止索引攻击           |
| `array_merge()`  | 合并数组                   | `array_merge($array1, $array2)`  | 防止恶意数组覆盖正常数据             |
| `unset()`        | 删除数组元素               | `unset($array[$key])`            | 验证键名的合法性                     |

#### 2.5.3 数组遍历方法

```php
<?php
    $userRoles = [
        "admin" => "管理员",
        "editor" => "编辑",
        "viewer" => "查看者"
    ];
    
    // 方法1：foreach遍历键值对
    foreach ($userRoles as $role => $description) {
        echo "角色: {$role} - 描述: {$description}<br>";
    }
    
    // 方法2：仅遍历值
    foreach ($userRoles as $description) {
        echo "描述: {$description}<br>";
    }
    
    // 方法3：使用while和each()（PHP 7.2+已废弃）
    // 不推荐使用，仅作了解
    
    // 方法4：for循环（仅适用于连续数字索引）
    $numbers = [1, 2, 3, 4, 5];
    for ($i = 0; $i < count($numbers); $i++) {
        echo "第{$i}个元素: {$numbers[$i]}<br>";
    }
?>
```

#### 2.5.4 数组安全实践

```php
<?php
    // 安全的数组操作类
    class SecureArrayHandler {
        
        // 安全的数组元素访问
        public static function safeGet($array, $key, $default = null) {
            // 验证参数
            if (!is_array($array)) {
                return $default;
            }
            
            // 使用isset()而不是array_key_exists()（性能更好）,且能过滤掉 null 的情况
            return isset($array[$key]) ? $array[$key] : $default;
        }
        
        // 安全的数组过滤
        /*
        1.只处理允许的字段：$allowedKeys 列表

        2.trim()：去掉首尾空格

        3.htmlspecialchars()：把 <, >, " 等转义为 HTML 实体，防止 XSS 攻击

          ENT_QUOTES：同时转义单引号 ' 和双引号 "

         'UTF-8'：确保编码安全
        */
        public static function filterArray($array, $allowedKeys) {
            if (!is_array($array) || !is_array($allowedKeys)) {
                return [];
            }
            
            $filtered = [];
            foreach ($allowedKeys as $key) {
                if (isset($array[$key])) {
                    // 基础清理
                    $filtered[$key] = htmlspecialchars(trim($array[$key]), ENT_QUOTES, 'UTF-8');
                }
            }
            
            return $filtered;
        }
        
        // 数组深度限制（防止嵌套过深的数组攻击）
        public static function validateArrayDepth($array, $maxDepth = 10, $currentDepth = 0) {
            if ($currentDepth >= $maxDepth) {
                return false;
            }
            
            if (!is_array($array)) {
                return true;
            }
            
            foreach ($array as $value) {
                if (is_array($value)) {
                    if (!self::validateArrayDepth($value, $maxDepth, $currentDepth + 1)) {
                        return false;
                    }
                }
            }
            
            return true;
        }
    }
    
    // 使用示例
    $userData = [
        "username" => "  admin  ",
        "password" => "secret123",
        "email" => "admin@example.com",
        "malicious_field" => "<script>alert('xss')</script>"
    ];
    //安全数组
    echo SecureArrayHandler::safeGet($userData, 'username', 0); // admin
    echo SecureArrayHandler::safeGet($userData, 'b', 0); // 0
    // 安全过滤
    $allowedFields = ["username", "email"];
    $filteredData = SecureArrayHandler::filterArray($userData, $allowedFields);
    
    print_r($filteredData);
    // 输出: Array ( [username] => admin [email] => admin@example.com )
?>

```

### 基础实验1：PHP基本语法综合练习

#### 实验目标

掌握 PHP 基本语法格式、数据类型、运算符、控制语句和数组操作的核心概念。

> **完整实验代码**：参考 `实验代码/php_basics.php`

#### 核心知识点与代码示例

**1. 基本语法格式与数据类型**

**概念要点**：
- PHP使用 `<?php ?>` 标记包围代码
- PHP是弱类型语言，变量不需要声明类型
- 使用 `gettype()` 检测变量类型

**关键代码**：
```php
<?php
    // 不同数据类型的声明
    $string_var = "Hello PHP!";
    $integer_var = 42;
    $float_var = 3.14159;
    $boolean_var = true;
    $null_var = null;
    
    // 类型检测
    echo gettype($string_var);  // string
    echo gettype($integer_var); // integer
    echo is_null($null_var) ? 'NULL' : $null_var;
?>
```

**2. 安全运算符使用**

**概念要点**：
- 弱类型比较（==）vs 强类型比较（===）
- 安全编程必须使用强类型比较
- 避免类型混淆攻击

**关键代码**：

```php
<?php
    $a = 10;
    $b = "10";
    
    // ❌ 危险：弱类型比较
    if ($a == $b) {
        echo "弱类型比较：相等"; // 会执行
    }
    
    // ✅ 安全：强类型比较
    if ($a === $b) {
        echo "强类型比较：相等";
    } else {
        echo "强类型比较：不相等"; // 会执行
    }
?>
```

**3. 控制语句最佳实践**

**概念要点**：
- 使用条件语句进行权限控制
- Switch语句处理多状态判断
- 循环语句的安全边界

**关键代码**：
```php
<?php
    // 安全的权限检查
    function checkUserPermission($role, $action) {
        switch ($role) {
            case 'admin':
                return true; // 管理员全权限
            case 'user':
                return in_array($action, ['read', 'update'], true);
            case 'guest':
                return $action === 'read';
            default:
                return false; // 默认拒绝
        }
    }
    
    // 安全的循环边界
    $max_attempts = 3;
    $attempts = 0;
    while ($attempts < $max_attempts) {
        // 处理逻辑
        $attempts++;
        if ($success) break; // 及时跳出
    }
?>
```

**4. 数组安全操作**

**概念要点**：

- 使用白名单验证数组元素
- 严格的数组查找（第三个参数true）
- 多维数组的安全遍历

**关键代码**：

```php
<?php
    // 安全的文件类型检查
    $allowed_types = ['jpg', 'png', 'gif'];
    $uploaded_file = 'image.jpg';
    
    $extension = strtolower(pathinfo($uploaded_file, PATHINFO_EXTENSION));
    $is_safe = in_array($extension, $allowed_types, true); // 严格比较
    
    if ($is_safe) {
        echo "文件类型安全";
    } else {
        echo "危险文件类型";
    }
    
    // 安全的关联数组处理
    $user_data = ['name' => 'admin', 'role' => 'user'];
    $allowed_keys = ['name', 'email'];
    
    foreach ($user_data as $key => $value) {
        if (in_array($key, $allowed_keys, true)) {
            echo htmlspecialchars($key) . ": " . htmlspecialchars($value);
        }
    }
?>
```

**5. 输入验证与安全过滤**

**概念要点**：
- 永远不信任用户输入
- 使用 `htmlspecialchars()` 防止XSS
- 根据上下文选择合适的过滤方式

**关键代码**：
```php
<?php
    // 安全的输入处理
    function sanitizeInput($input, $type = 'string') {
        $input = trim($input);
        
        switch ($type) {
            case 'string':
                return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
            case 'email':
                return filter_var($input, FILTER_VALIDATE_EMAIL) ?: false;
            case 'int':
                return filter_var($input, FILTER_VALIDATE_INT) ?: 0;
            default:
                return htmlspecialchars($input, ENT_QUOTES, 'UTF-8');
        }
    }
    
    // 使用示例
    $user_input = "<script>alert('XSS')</script>";
    $safe_output = sanitizeInput($user_input, 'string');
    echo $safe_output; // &lt;script&gt;alert('XSS')&lt;/script&gt;
?>
```

#### 实验要点总结

**安全编程原则**：
1. **类型安全**：始终使用强类型比较（===）
2. **输入验证**：验证所有外部数据
3. **输出编码**：根据上下文编码输出
4. **白名单策略**：使用白名单而非黑名单

**核心函数掌握**：
- `gettype()`, `is_*()` - 类型检测
- `htmlspecialchars()` - XSS防护
- `filter_var()` - 数据验证
- `in_array($val, $array, true)` - 严格数组查找

#### 实验扩展

1. **修改 `php_basics.php`** 尝试不同场景
2. **安全测试**：输入恶意代码观察过滤效果
3. **性能对比**：测试强弱类型比较的性能差异

---

**实验运行指南**：

**环境准备**：

- Windows：使用 小皮面板
- 或 PHP 内置服务器：`php -S localhost:8000`
- 或VS Code PHP server

**运行步骤**：
1. 访问 `http://localhost/php_basics.php`
2. 观察各部分输出结果
3. 重点关注安全过滤效果

## 三、综合代码

#### **代码示例 php_basics.php**

    <!DOCTYPE html>
    <html>
    <head>
        <title>PHP基本语法练习</title>
        <meta charset="UTF-8">
        <style>
            body { font-family: Arial, sans-serif; margin: 20px; }
            .section { margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; }
            .code { background: #f4f4f4; padding: 10px; margin: 10px 0; }
            .result { background: #e8f5e8; padding: 10px; margin: 10px 0; }
            .warning { background: #fff3cd; padding: 10px; margin: 10px 0; color: #856404; }
        </style>
    </head>
    <body>
        <h1>PHP基本语法综合练习</h1>
        
        <div class="section">
            <h2>1. 基本语法格式与数据类型</h2>
            <?php
                // 不同的数据类型
                $string_var = "Hello PHP!";
                $integer_var = 42;
                $float_var = 3.14159;
                $boolean_var = true;
                
                echo "<div class='result'>";
                echo "<p>字符串变量: $string_var (" . gettype($string_var) . ")</p>";
                echo "<p>整数变量: $integer_var (" . gettype($integer_var) . ")</p>";
                echo "<p>浮点数变量: $float_var (" . gettype($float_var) . ")</p>";
                echo "<p>布尔变量: " . ($boolean_var ? 'true' : 'false') . " (" . gettype($boolean_var) . ")</p>";
                echo "</div>";
            ?>
        </div>
        
        <div class="section">
            <h2>2. 运算符练习</h2>
            <?php
                $a = 10;
                $b = 3;
                
                echo "<div class='result'>";
                echo "<h3>算术运算符：</h3>";
                echo "<p>$a + $b = " . ($a + $b) . "</p>";
                echo "<p>$a - $b = " . ($a - $b) . "</p>";
                echo "<p>$a * $b = " . ($a * $b) . "</p>";
                echo "<p>$a / $b = " . ($a / $b) . "</p>";
                echo "<p>$a % $b = " . ($a % $b) . "</p>";
                
                echo "<h3>比较运算符（安全示例）：</h3>";
                echo "<p>弱类型比较 $a == '10': " . ($a == '10' ? 'true' : 'false') . "</p>";
                echo "<p>强类型比较 $a === '10': " . ($a === '10' ? 'true' : 'false') . "</p>";
                echo "</div>";
                
                echo "<div class='warning'>";
                echo "<strong>安全提示：</strong>始终使用强类型比较（===）避免类型混淆攻击！";
                echo "</div>";
            ?>
        </div>
        
        <div class="section">
            <h2>3. 控制语句练习</h2>
            <?php
                $userScore = 85;
                
                echo "<div class='result'>";
                echo "<h3>条件语句：</h3>";
                echo "<p>学生分数：$userScore</p>";
                
                // if-elseif-else
                if ($userScore >= 90) {
                    $grade = "优秀";
                } elseif ($userScore >= 80) {
                    $grade = "良好";
                } elseif ($userScore >= 70) {
                    $grade = "中等";
                } elseif ($userScore >= 60) {
                    $grade = "及格";
                } else {
                    $grade = "不及格";
                }
                echo "<p>等级：$grade</p>";
                
                // switch语句
                $dayOfWeek = date('w');
                $dayName = "";
                
                switch ($dayOfWeek) {
                    case 0: $dayName = "星期日"; break;
                    case 1: $dayName = "星期一"; break;
                    case 2: $dayName = "星期二"; break;
                    case 3: $dayName = "星期三"; break;
                    case 4: $dayName = "星期四"; break;
                    case 5: $dayName = "星期五"; break;
                    case 6: $dayName = "星期六"; break;
                    default: $dayName = "未知"; break;
                }
                echo "<p>今天是：$dayName</p>";
                
                echo "<h3>循环语句：</h3>";
                
                // for循环
                echo "<p>for循环示例（1-5）：";
                for ($i = 1; $i <= 5; $i++) {
                    echo "$i ";
                }
                echo "</p>";
                
                // while循环
                echo "<p>while循环示例（倒计时）：";
                $countdown = 5;
                while ($countdown > 0) {
                    echo "$countdown ";
                    $countdown--;
                }
                echo "</p>";
                echo "</div>";
            ?>
        </div>
        
        <div class="section">
            <h2>4. PHP数组练习</h2>
            <?php
                echo "<div class='result'>";
                
                // 索引数组
                $fruits = ["苹果", "香蕉", "橙子", "草莓"];
                echo "<h3>索引数组：</h3>";
                echo "<p>水果列表：</p><ul>";
                foreach ($fruits as $index => $fruit) {
                    echo "<li>索引 $index: $fruit</li>";
                }
                echo "</ul>";
                
                // 关联数组
                $student = [
                    "name" => "张三",
                    "age" => 20,
                    "major" => "网络安全",
                    "score" => 88.5
                ];
                
                echo "<h3>关联数组：</h3>";
                echo "<p>学生信息：</p><ul>";
                foreach ($student as $key => $value) {
                    echo "<li>$key: $value</li>";
                }
                echo "</ul>";
                
                // 多维数组
                $classes = [
                    "网络安全班" => [
                        "学生数" => 30,
                        "教师" => "李老师",
                        "课程" => ["PHP基础", "Web安全", "渗透测试"]
                    ],
                    "软件开发班" => [
                        "学生数" => 25,
                        "教师" => "王老师",
                        "课程" => ["Java", "Python", "数据库"]
                    ]
                ];
                
                echo "<h3>多维数组：</h3>";
                foreach ($classes as $className => $classInfo) {
                    echo "<h4>$className</h4>";
                    echo "<ul>";
                    foreach ($classInfo as $key => $value) {
                        if (is_array($value)) {
                            echo "<li>$key: " . implode(", ", $value) . "</li>";
                        } else {
                            echo "<li>$key: $value</li>";
                        }
                    }
                    echo "</ul>";
                }
                
                // 数组函数演示
                echo "<h3>数组函数演示：</h3>";
                echo "<p>水果数组元素个数：" . count($fruits) . "</p>";
                
                // 安全的数组搜索
                $searchFruit = "香蕉";
                if (in_array($searchFruit, $fruits, true)) {  // 使用严格比较
                    echo "<p>✅ 找到了：$searchFruit</p>";
                } else {
                    echo "<p>❌ 没有找到：$searchFruit</p>";
                }
                
                echo "</div>";
            ?>
        </div>
        
        <div class="section">
            <h2>5. 综合练习：安全的用户数据处理</h2>
            <?php
                // 模拟用户输入数据
                $rawUserData = [
                    "username" => "  admin  ",
                    "email" => "admin@example.com",
                    "age" => "25",
                    "interests" => ["编程", "安全", "游戏"],
                    "malicious" => "<script>alert('XSS')</script>"
                ];
                
                echo "<div class='result'>";
                echo "<h3>原始数据：</h3>";
                echo "<pre>" . print_r($rawUserData, true) . "</pre>";
                
                // 安全处理
                $cleanUserData = [];
                $allowedFields = ["username", "email", "age", "interests"];
                
                foreach ($allowedFields as $field) {
                    if (isset($rawUserData[$field])) {
                        if (is_array($rawUserData[$field])) {
                            $cleanUserData[$field] = array_map('htmlspecialchars', $rawUserData[$field]);
                        } else {
                            $cleanUserData[$field] = htmlspecialchars(trim($rawUserData[$field]), ENT_QUOTES, 'UTF-8');
                        }
                    }
                }
                
                echo "<h3>安全处理后的数据：</h3>";
                echo "<pre>" . print_r($cleanUserData, true) . "</pre>";
                echo "</div>";
                
                echo "<div class='warning'>";
                echo "<strong>安全要点：</strong><br>";
                echo "1. 使用白名单过滤字段<br>";
                echo "2. 使用htmlspecialchars()防止XSS<br>";
                echo "3. 使用trim()去除多余空格<br>";
                echo "4. 验证数据类型和格式";
                echo "</div>";
            ?>
        </div>
        
        <div class="section">
            <h2>6. PHP环境安全检查</h2>
            <?php
                echo "<div class='result'>";
                echo "<h3>PHP版本信息：</h3>";
                echo "<p>PHP版本：" . PHP_VERSION . "</p>";
                echo "<p>服务器系统：" . PHP_OS . "</p>";
                
                echo "<h3>重要安全配置：</h3>";
                $securityChecks = [
                    'display_errors' => '应该为 Off（生产环境）',
                    'expose_php' => '应该为 Off',
                    'allow_url_include' => '应该为 Off',
                    'register_globals' => '应该为 Off'
                ];
                
                foreach ($securityChecks as $setting => $recommendation) {
                    $value = ini_get($setting) ? 'On' : 'Off';
                    $status = (($setting === 'display_errors' || $setting === 'expose_php' || 
                              $setting === 'allow_url_include' || $setting === 'register_globals') 
                              && $value === 'Off') ? '✅' : '⚠️';
                    echo "<p>$status $setting: $value - $recommendation</p>";
                }
                echo "</div>";
            ?>
        </div>
        
        <div class="section">
            <h2>实验总结</h2>
            <div class="warning">
                <h3>本次实验涵盖的要点：</h3>
                <ul>
                    <li>✅ PHP基本语法格式和标记</li>
                    <li>✅ 各种数据类型的使用和识别</li>
                    <li>✅ 算术、比较、逻辑运算符</li>
                    <li>✅ if-else、switch、for、while等控制语句</li>
                    <li>✅ 索引数组、关联数组、多维数组</li>
                    <li>✅ 数组常用函数和安全操作</li>
                    <li>✅ 输入数据的安全处理</li>
                    <li>✅ PHP环境安全配置检查</li>
                </ul>
                
                <h3>安全编程要点：</h3>
                <ul>
                    <li>始终使用强类型比较（===）</li>
                    <li>对用户输入进行严格验证和过滤</li>
                    <li>使用白名单而不是黑名单</li>
                    <li>注意PHP环境的安全配置</li>
                </ul>
            </div>
        </div>
    </body>
    </html>
2. **运行测试**：
   - 将文件保存为 `php_basics.php`
   - 放在 Web 根目录下
   - 访问 `http://localhost/php_basics.php`
   - 观察各部分的输出结果

#### 实验思考

1. 弱类型比较和强类型比较的区别是什么？在安全方面有什么影响？
2. 为什么要使用 `htmlspecialchars()` 函数处理用户输入？
3. 数组的 `in_array()` 函数为什么要加第三个参数 `true`？
4. 如何安全地处理多维数组中的用户数据？

## 四、课程总结

### 3.1 本章知识点总结

在本章PHP基本语法学习中，我们掌握了以下核心内容：

| 知识模块         | 主要内容                                   | 安全要点                                      |
| ---------------- | ------------------------------------------ | --------------------------------------------- |
| **基本语法格式** | PHP标记、代码结构、注释规范                | 选择正确的PHP标记，避免短标记带来的兼容性问题 |
| **数据类型**     | 字符串、整数、浮点、布尔、数组、对象、NULL | 理解弱类型特性，使用强类型比较避免类型混淆    |
| **运算符**       | 算术、比较、逻辑、赋值运算符               | 强制使用===和!==进行严格比较                  |
| **控制语句**     | if-else、switch、for、while、foreach       | 合理使用控制结构，注意边界条件处理            |
| **PHP数组**      | 索引数组、关联数组、多维数组、数组函数     | 安全的数组操作，防止数组注入和越界访问        |

### 3.2 安全编程原则

1. **输入验证原则**
   - 永远不要信任用户输入
   - 使用白名单而不是黑名单
   - 对所有外部数据进行验证和过滤

2. **类型安全原则**
   - 使用强类型比较（===, !==）
   - 验证变量类型和格式
   - 避免隐式类型转换带来的安全隐患

3. **输出安全原则**
   - 使用htmlspecialchars()防止XSS
   - 根据上下文选择合适的编码函数
   - 不要直接输出未经处理的用户数据

### 3.3 下一步学习方向

完成PHP基本语法学习后，建议按以下顺序继续学习：

1. **PHP函数** - 学习用户定义函数、参数传递、作用域等
2. **PHP类与对象** - 掌握面向对象编程基础
3. **PHP正则表达式** - 学习模式匹配和数据验证
4. **PHP调用MySQL** - 掌握数据库操作和SQL安全

### 3.4 实践建议

1. **多动手练习**：每个语法点都要通过实际代码练习
2. **关注安全**：从一开始就培养安全编程习惯
3. **查阅文档**：熟练使用PHP官方文档
4. **代码规范**：遵循PSR编码规范

通过本章学习，你已经掌握了PHP编程的基础知识，为后续的Web安全学习打下了坚实的基础。记住，安全始终是第一位的，每写一行代码都要考虑可能的安全隐患。